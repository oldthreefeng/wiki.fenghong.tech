---
title: "记一次阿里云服务器转移"
date: "2019-05-07 17:09:32"
tags: 
  - ops
  - devops
---
[TOC]

## 项目背景

由于业务需求，主要就是公司分公司太多，费用计算发生变化，导致需要进行账户转移，需要将一台阿里云的ECS转移至其他账户下，因此写下这篇文章来进行记录，

### 转移前

考虑到目前的ECS是有业务在跑的，首先考虑的就是业务不受影响转移,但是这个经过和阿里云沟通，发现必须重启实例方可转移。

1. 项目的运行环境；
2. 项目的后端数据库链接，中间件redis链接不可丢失；
3. 项目的数据不可丢失(随实例创建的系统盘和数据盘可以一起过户。)；
4. 进行镜像快照，如果转移失败可以根据快照重新开一台ECS；
5. 原有的相关组件去除，如SLB关联相关的，必须取消，否则转移失败；
6. 创建的ECS必须要有经典网络的安全组，这个必须和源ECS相同属性。
7. 项目转移成功后各项服务重启
8. 阿里云客服的及时沟通
9. 保证目标账户余额充足，不然转移成功后，会发生因费用不足而拒绝服务。

```
阿里云官方提示：

需要提供：
	源账号和目标账号
	需要过户的实例ID列表
	过户的目标安全组（目标安全组与目标交换机必须在同一个VPC内）
	过户的目标交换机（目标交换机与过户的实例必须在同一个可用区内）
VPC类型的ECS实例在过户前必须先停机，请您提前安排好停机时间。
源账号和目标账号如果存在欠费，必须先缴清欠费。
过户实例在源账号下关联的RDS、OSS、SLB等服务将会受到影响，实例源账号和目标账号需要提前做好业务变更准备。
```

### 转移中

时间定位在下班附近，开启转移操作~

源账户提交工单进行转移操作，

**过户还需要目标账号提交一个同意接收主机的工单**，如果创建不了经典组网络安全组，必须再次提交工单创建经典安全组权限。这个比较坑爹~话了很长时间才传递好

源ECS的关联业务拆除，比如SLB；转移过程如有问题，根据客服的要求进行变更。

这个转移过程中，有一个要确认关机重启的操作，谨慎点，做好通知、备份等工作后，再执行重启，按下确认按钮前想一想。

### 转移后

- 挂载在实例上的独立云盘已经过户到目标账号下
- 实例已从源账号的安全组中移除，并且已经添加到目标账号的安全组中
- ECS上服务检查，数据检查，服务重启
- 安全组更迭，增加原账户的相关权限（如RDS，OSS，REDIS）等内网权限
- 私有IP地址会发生变动，由目标交换机根据CIDR重新分配，（如果是很早分配的ip，基本是不会变动的）